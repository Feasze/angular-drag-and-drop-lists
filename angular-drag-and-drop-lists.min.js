/**
 * angular-drag-and-drop-lists v1.4.0
 *
 * Copyright (c) 2014 Marcel Juenemann marcel@juenemann.cc
 * Copyright (c) 2014-2016 Google Inc.
 * https://github.com/marceljuenemann/angular-drag-and-drop-lists
 *
 * License: MIT
 */
angular.module("dndLists",[]).directive("dndDraggable",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround","dndDraggingOverList",function(e,n,r,a,t){return function(d,o,i){o.attr("draggable","true"),i.dndDisableIf&&d.$watch(i.dndDisableIf,function(e){o.attr("draggable",!e)}),o.on("dragstart",function(t){return t=t.originalEvent||t,"false"==o.attr("draggable")||(t.dataTransfer.setData("Text",angular.toJson(d.$eval(i.dndDraggable))),t.dataTransfer.effectAllowed=i.dndEffectAllowed||"move",o.addClass("dndDragging"),n(function(){o.addClass("dndDraggingSource")},0),r.dropEffect="none",a.isDragging=!0,a.dragType=i.dndType?d.$eval(i.dndType):void 0,t._dndHandle&&t.dataTransfer.setDragImage&&t.dataTransfer.setDragImage(o[0],0,0),e(i.dndDragstart)(d,{event:t}),void t.stopPropagation())}),o.on("dragend",function(l){l=l.originalEvent||l
var f=r.dropEffect
d.$apply(function(){switch(f){case"move":e(i.dndMoved)(d,{event:l})
break
case"copy":e(i.dndCopied)(d,{event:l})
break
case"none":e(i.dndCanceled)(d,{event:l})}e(i.dndDragend)(d,{event:l,dropEffect:f})}),o.removeClass("dndDragging"),n(function(){o.removeClass("dndDraggingSource")},0),a.isDragging=!1,t.placeholderCallback&&t.placeholderCallback(),l.stopPropagation()}),o.on("click",function(n){i.dndSelected&&(n=n.originalEvent||n,d.$apply(function(){e(i.dndSelected)(d,{event:n})}),n.stopPropagation())}),o.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]).directive("dndList",["$parse","$timeout","dndDropEffectWorkaround","dndDragTypeWorkaround","dndDraggingOverList",function(e,n,r,a,t){return function(d,o,i){function l(e,n,r){var a=y?e.offsetX||e.layerX:e.offsetY||e.layerY,t=y?n.offsetWidth:n.offsetHeight,d=y?n.offsetLeft:n.offsetTop
return d=r?d:0,a<d+t/2}function f(){var e
return angular.forEach(o.children(),function(n){var r=angular.element(n)
r.hasClass("dndPlaceholder")&&(e=r)}),e||angular.element("<li class='dndPlaceholder'></li>")}function g(){return Array.prototype.indexOf.call(E.children,D)}function s(e){if(!a.isDragging&&!m)return!1
if(!p(e.dataTransfer.types))return!1
if(i.dndAllowedTypes&&a.isDragging){var n=d.$eval(i.dndAllowedTypes)
if(angular.isArray(n)&&n.indexOf(a.dragType)===-1)return!1}return!i.dndDisableIf||!d.$eval(i.dndDisableIf)}function c(){return v.remove(),o.removeClass("dndDragover"),!0}function u(n,r,t,o){return e(n)(d,{event:r,index:t,item:o||void 0,external:!a.isDragging,type:a.isDragging?a.dragType:void 0})}function p(e){if(!e)return!0
for(var n=0;n<e.length;n++)if("Text"===e[n]||"text/plain"===e[n])return!0
return!1}var v=f(),D=v[0],E=o[0]
v.remove()
var y=i.dndHorizontalList&&d.$eval(i.dndHorizontalList),m=i.dndExternalSources&&d.$eval(i.dndExternalSources)
o.on("dragenter",function(e){return e=e.originalEvent||e,!s(e)||void e.preventDefault()}),o.on("dragover",function(e){if(e=e.originalEvent||e,t.lastDragoverList!=o&&(t.lastDragoverList=o,t.placeholderCallback&&(t.placeholderCallback(),t.placeholderCallback=null)),!s(e))return!0
if(D.parentNode!=E&&o.append(v),e.target!==E){for(var n=e.target;n.parentNode!==E&&n.parentNode;)n=n.parentNode
n.parentNode===E&&n!==D&&(l(e,n)?E.insertBefore(D,n):E.insertBefore(D,n.nextSibling))}else if(l(e,D,!0))for(;D.previousElementSibling&&(l(e,D.previousElementSibling,!0)||0===D.previousElementSibling.offsetHeight);)E.insertBefore(D,D.previousElementSibling)
else for(;D.nextElementSibling&&!l(e,D.nextElementSibling,!0);)E.insertBefore(D,D.nextElementSibling.nextElementSibling)
return i.dndDragover&&!u(i.dndDragover,e,g())?c():(o.addClass("dndDragover"),e.preventDefault(),e.stopPropagation(),!1)}),o.on("drop",function(e){if(e=e.originalEvent||e,t.lastDragoverList=null,!s(e))return!0
e.preventDefault()
var n,a=e.dataTransfer.getData("Text")||e.dataTransfer.getData("text/plain")
try{n=JSON.parse(a)}catch(e){return c()}var o=g()
return i.dndDrop&&(n=u(i.dndDrop,e,o,n),!n)?c():(n!==!0&&d.$apply(function(){d.$eval(i.dndList).splice(o,0,n)}),u(i.dndInserted,e,o,n),"none"===e.dataTransfer.dropEffect?"copy"===e.dataTransfer.effectAllowed||"move"===e.dataTransfer.effectAllowed?r.dropEffect=e.dataTransfer.effectAllowed:r.dropEffect=e.ctrlKey?"copy":"move":r.dropEffect=e.dataTransfer.dropEffect,c(),e.stopPropagation(),!1)}),o.on("dragleave",function(e){e=e.originalEvent||e,o.removeClass("dndDragover"),a.isDragging?t.lastDragoverList==o&&(t.placeholderCallback=function(){o.removeClass("dndDragover"),v.remove()}):(t.lastDragoverList=null,n(function(){o.hasClass("dndDragover")||v.remove()},100))})}}]).directive("dndNodrag",function(){return function(e,n,r){n.attr("draggable","true"),n.on("dragstart",function(e){e=e.originalEvent||e,e._dndHandle||(e.dataTransfer.types&&e.dataTransfer.types.length||e.preventDefault(),e.stopPropagation())}),n.on("dragend",function(e){e=e.originalEvent||e,e._dndHandle||e.stopPropagation()})}}).directive("dndHandle",function(){return function(e,n,r){n.attr("draggable","true"),n.on("dragstart dragend",function(e){e=e.originalEvent||e,e._dndHandle=!0})}}).factory("dndDragTypeWorkaround",function(){return{}}).factory("dndDropEffectWorkaround",function(){return{}}).factory("dndDraggingOverList",function(){return{}})
